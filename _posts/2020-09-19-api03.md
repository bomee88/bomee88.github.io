---
title: "[íŒ¨ìŠ¤íŠ¸ìº í¼ìŠ¤ ìˆ˜ê°• í›„ê¸°] í”„ë¡ íŠ¸ì—”ë“œ ì¸ê°• 100% í™˜ê¸‰ ì±Œë¦°ì§€ 41íšŒì°¨ ë¯¸ì…˜ - 33ê°• react-async, Contextì—ì„œ ë¹„ë™ê¸°ì‘ì—… ìƒíƒœê´€ë¦¬"
date: 2020-09-19
categories: fastcampus
tags: fastcampus all-in-one-challenge day41 react styled-components
---

# react-async

ë§¤ë²ˆ í›…ì„ ë§Œë“œëŠ”ê²Œ ìµìˆ™í•˜ê³  í¸í•˜ë‹¤ë©´ ê·¸ëƒ¥ ê·¸ë ‡ê²Œ í•´ë„ ë˜ê² ì§€ë§Œ ë§¤ë²ˆ í”„ë¡œì íŠ¸ë§ˆë‹¤ ê·¸ë ‡ê²Œ í•˜ëŠ”ê²Œ í˜ë“¤ë‹¤ë©´ react-asyncë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ëŠ” ë§ì€ ê¸°ëŠ¥ì´ ë‚´ì¥ë˜ì–´ìˆë‹¤. ê°€ì¥ ê¸°ë³¸ì ì¸ ê¸°ëŠ¥ì€ useAsyncì´ë‹¤. ê¸°ì¡´ì— ë§Œë“¤ì—ˆë˜ ì½”ë“œë¥¼ react-asyncë¡œ ë°”ê¿”ë³´ë„ë¡ í•˜ì.

> User.js

```javascript
import React from "react";
import axios from "axios";
import { useAsync } from "react-async"; //react-asyncë¡œ ìˆ˜ì •

async function getUser({ id }) {
  const response = await axios.get(
    `http://jsonplaceholder.typicode.com/users/${id}`
  );
  return response.data;
}

function User({ id }) {
  const { data: user, error, isLoading } = useAsync({
    //react-asyncë¡œ ìˆ˜ì •
    promiseFn: getUser,
    id,
    watch: id,
  });

  if (isLoading) return <div>ë¡œë”©ì¤‘...</div>;
  if (error) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>;
  if (!user) return null;
  return (
    <div>
      <h2>{user.username}</h2>
      <p>
        <b>Email:</b> {user.email}
      </p>
    </div>
  );
}

export default User;
```

> Users.js

```javascript
import React, { useState } from "react";
import axios from "axios";
import { useAsync } from "react-async"; //react-asyncë¡œ ìˆ˜ì •
import User from "./User";

async function getUsers() {
  const response = await axios.get("http://jsonplaceholder.typicode.com/users");
  return response.data;
}

function Users() {
  const [userId, setUserId] = useState(null);
  const { data: users, error, isLoading, reload } = useAsync({
    //react-asyncë¡œ ìˆ˜ì •
    promiseFn: getUsers,
  });

  if (isLoading) return <div>ë¡œë”©ì¤‘..</div>;
  if (error) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. </div>;
  if (!users) return <button onClick={reload}>ë¶ˆëŸ¬ì˜¤ê¸°</button>;

  return (
    <>
      <ul>
        {users.map((user) => (
          <li key={user.id} onClick={() => setUserId(user.id)}>
            {user.username} ({user.name})
          </li>
        ))}
      </ul>
      <button onClick={reload}>ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
      {userId && <User id={userId} />}
    </>
  );
}

export default Users;
```

ì´ë ‡ê²Œ í•˜ê³  ì‹œì‘í•´ë³´ë©´ ì „ì²´ ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  lií´ë¦­ì‹œ userì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.  
ê·¸ëŸ¼ ì—¬ê¸°ì„œ ì´ì „ì²˜ëŸ¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ë°”ë¡œ ë¶ˆëŸ¬ì˜¤ì§€ ì•Šê³  íŠ¹ì • ë²„íŠ¼ì„ ëˆ„ë¥¼ ì‹œ ë¶ˆëŸ¬ì˜¤ê²Œ í•´ë³´ì.

> Users.js

```javascript
import React, { useState } from "react";
import axios from "axios";
import { useAsync } from "react-async";
import User from "./User";

async function getUsers() {
  const response = await axios.get("http://jsonplaceholder.typicode.com/users");
  return response.data;
}

function Users() {
  const [userId, setUserId] = useState(null);
  const { data: users, error, isLoading, reload, run } = useAsync({
    // runì¶”ê°€
    deferFn: getUsers,
  });

  if (isLoading) return <div>ë¡œë”©ì¤‘..</div>;
  if (error) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. </div>;
  if (!users) return <button onClick={run}>ë¶ˆëŸ¬ì˜¤ê¸°</button>; // runì¶”ê°€

  return (
    <>
      <ul>
        {users.map((user) => (
          <li key={user.id} onClick={() => setUserId(user.id)}>
            {user.username} ({user.name})
          </li>
        ))}
      </ul>
      <button onClick={reload}>ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
      {userId && <User id={userId} />}
    </>
  );
}

export default Users;
```

## ì¥ì  ë° ë‹¨ì 

ì¥ì ìœ¼ë¡œëŠ” í•„ìš”í• ë•Œ ì„¤ì¹˜í•´ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì„œ ê°„í¸í•´ì„œ ì¢‹ë‹¤.
í›… ë§ê³  ì»´í¬ë„ŒíŠ¸ í˜•íƒœë¡œë„ ì‚¬ìš©í•  ìˆ˜ ìˆê¸°ë„ í•˜ë‹¤.
íŠ¹ì • í”„ë¡œë¯¸ìŠ¤ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì‘ì—…ì„ ë„ì¤‘ì— ì·¨ì†Œí•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ë„ ìˆë‹¤.  
ë°˜ë©´ ë‹¨ì ì€ ì˜µì…˜ì´ ë‹¤ì–‘í•˜ê³  ë³µì¡í•˜ë‹¤. ê·¸ë˜ì„œ ì²˜ìŒì— ì¡°ê¸ˆ í—·ê°ˆë¦´ ìˆ˜ë„ ìˆë‹¤.
ë§Œì•½ ì»¤ìŠ¤í…€ í›…ì„ ë§Œë“œëŠ”ê²Œ ë³„ë¡œ ì–´ë µê²Œ ëŠê»´ì§€ì§€ ì•ŠëŠ”ë‹¤ë©´ ì§ì ‘ ë§Œë“¤ì–´ì„œ ì“°ëŠ” ê²ƒë„ ë‚˜ì˜ì§€ ì•Šì€ ì„ íƒì´ë‹¤.

# Contextì—ì„œ ë¹„ë™ê¸°ì‘ì—… ìƒíƒœ ê´€ë¦¬í•˜ê¸°

ë¡œê·¸ì¸ ì¤‘ì¸ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ì²´í¬í•˜ëŠ” ì‘ì—…ì„ í•œë‹¤ë©´ ë‹¤ì–‘í•œ ê³³ì—ì„œ ì‚¬ìš©ìì˜ ë¡œê·¸ì¸ ìƒíƒœë¥¼ í•„ìš”ë¡œ í•  ìˆ˜ ìˆë‹¤. ì—¬ê¸°ì €ê¸°ì„œ í•„ìš” í•œ ìƒíƒœë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°ì—” ë°ì´í„°ë¥¼ Contextì— ë„£ì–´ì¤˜ì„œ ì‘ì—…í•˜ë©´ í¸í•˜ë‹¤. ë§Œì•½ Context ë‚´ë¶€ì—ì„œ ë¹„ë™ê¸°ì‘ì—…ì„ ìœ„í•œ ìƒíƒœê´€ë¦¬ë¥¼ í•œë‹¤ë©´ ì–´ë–»ê²Œí•˜ëŠ”ê²Œ íš¨ìœ¨ì ì¸ì§€ ì•Œì•„ë³´ì.

> UsersContext.js

```javascript
import React, { createContext, useReducer, useContext } from "react";
import axios from "axios";

const initialState = {
  users: {
    loading: false,
    data: null,
    error: null,
  },
  user: {
    loading: false,
    data: null,
    error: null,
  },
};

const loadingState = {
  loading: true,
  data: null,
  error: null,
};

const success = (data) => ({
  lading: false,
  data,
  error: null,
});
const error = (e) => ({
  loading: false,
  data: null,
  error: e,
});

// GET_USERS
// GET_USERS_SUCCESS
// GET_USERS_ERROR
// GET_USER
// GET_USER_SUCCESS
// GET_USER_ERROR

function usersReducer(state, action) {
  switch (action.type) {
    case "GET_USERS":
      return {
        ...state,
        users: loadingState,
      };
    case "GET_USERS_SUCCESS":
      return {
        ...state,
        users: success(action.data),
      };
    case "GET_USERS_ERROR":
      return {
        ...state,
        users: error(action.error),
      };
    case "GET_USER":
      return {
        ...state,
        user: loadingState,
      };
    case "GET_USER_SUCCESS":
      return {
        ...state,
        user: success(action.data),
      };
    case "GET_USER_ERROR":
      return {
        ...state,
        user: error(action.error),
      };
    default:
      throw new Error("Unhandled action type", action.type);
  }
}

const UsersStateContext = createContext(null);
const UsersDispatchContext = createContext(null);

export function UsersProvider({ children }) {
  const [state, dispatch] = useReducer(usersReducer, initialState);
  return (
    <UsersStateContext.Provider value={state}>
      <UsersDispatchContext.Provider value={dispatch}>
        {children}
      </UsersDispatchContext.Provider>
    </UsersStateContext.Provider>
  );
}

export function useUsersState() {
  const state = useContext(UsersStateContext);
  if (!state) {
    throw new Error("Cannot find UserProvider");
  }
  return state;
}

export function useUsersDispatch() {
  const dispatch = useContext(UsersDispatchContext);
  if (!dispatch) {
    throw new Error("Cannot find UserProvider");
  }
  return dispatch;
}

export async function getUsers(dispatch) {
  dispatch({ type: "GET_USERS" });
  try {
    const response = await axios.get(
      "http://jsonplaceholder.typicode.com/users"
    );
    dispatch({
      type: "GET_USERS_SUCCESS",
      data: response.data,
    });
  } catch (e) {
    dispatch({
      type: "GET_USERS_ERROR",
      error: e,
    });
  }
}

export async function getUser(dispatch, id) {
  dispatch({ type: "GET_USER" });
  try {
    const response = await axios.get(
      `http://jsonplaceholder.typicode.com/users/${id}`
    );
    dispatch({
      type: "GET_USER_SUCCESS",
      data: response.data,
    });
  } catch (e) {
    dispatch({
      type: "GET_USER_ERROR",
      error: e,
    });
  }
}
```

> User.js

```javascript
import React, { useEffect } from "react";
import { getUser, useUsersState, useUsersDispatch } from "./UsersContext";

function User({ id }) {
  const state = useUsersState();
  const dispatch = useUsersDispatch();

  useEffect(() => {
    getUser(dispatch, id);
  }, [dispatch, id]);
  const { loading, data: user, error } = state.user;

  if (loading) return <div>ë¡œë”©ì¤‘...</div>;
  if (error) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>;
  if (!user) return null;
  return (
    <div>
      <h2>{user.username}</h2>
      <p>
        <b>Email:</b> {user.email}
      </p>
    </div>
  );
}

export default User;
```

> Users.js

```javascript
import React, { useState } from "react";
import { useUsersState, useUsersDispatch, getUsers } from "./UsersContext";
import User from "./User";

function Users() {
  const [userId, setUserId] = useState(null);
  const state = useUsersState();
  const dispatch = useUsersDispatch();

  const { loading, data: users, error } = state.users;

  const fetchData = () => {
    getUsers(dispatch);
  };
  if (loading) return <div>ë¡œë”©ì¤‘..</div>;
  if (error) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. </div>;
  if (!users) return <button onClick={fetchData}>ë¶ˆëŸ¬ì˜¤ê¸°</button>;

  return (
    <>
      <ul>
        {users.map((user) => (
          <li key={user.id} onClick={() => setUserId(user.id)}>
            {user.username} ({user.name})
          </li>
        ))}
      </ul>
      <button onClick={fetchData}>ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
      {userId && <User id={userId} />}
    </>
  );
}

export default Users;
```

ì´ì™€ ê°™ì´ Contextë¡œ ì™„ë£Œí•´ë´¤ë‹¤.. ê·¼ë° ì™œí•œê±´ì§€ ì˜ ëª¨ë¥´ê² ë‹¤..;  
ì•„ë¬´ë˜ë„ javascriptì˜ ê¸°ë³¸ì´ ì œëŒ€ë¡œ ì•ˆë˜ì–´ìˆì–´ì„œ ì´í•´ê°€ ì˜ ì•ˆë˜ëŠ”ê°€ë³´ë‹¤ ã…œã…œ  
Promise, await, async ë‹¤ì‹œ ê³µë¶€í•˜ê³  ì™€ì•¼ê² ë‹¤.  
ì˜¤ëŠ˜ì€ ì—¬ê¸°ê¹Œì§€..  
ì‹œì²­ ì˜ìƒ 33ê°• 03~04ê¹Œì§€  
![ìˆ˜ê°•ì¸ì¦ì´ë¯¸ì§€](/images/200919-2.png)
![ìˆ˜ê°•ì¸ì¦ì´ë¯¸ì§€](/images/200919-3.png)
![ìˆ˜ê°•ì¸ì¦ì´ë¯¸ì§€](/images/200919-1.jpeg)
í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ì˜¬ì¸ì› íŒ¨í‚¤ì§€ with React Online. ğŸ‘‰ https://bit.ly/31Cf1hp
