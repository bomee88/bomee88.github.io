---
title: "[íŒ¨ìŠ¤íŠ¸ìº í¼ìŠ¤ ìˆ˜ê°• í›„ê¸°] í”„ë¡ íŠ¸ì—”ë“œ ì¸ê°• 100% í™˜ê¸‰ ì±Œë¦°ì§€ 40íšŒì°¨ ë¯¸ì…˜ - 33ê°• useReducer, useAsync, ì»¤ìŠ¤í…€ Hook"
date: 2020-09-18
categories: fastcampus
tags: fastcampus all-in-one-challenge day40 react
---

# useReducerë¡œ ìš”ì²­ ìƒíƒœ ê´€ë¦¬í•˜ê¸°

ì´ì „ì— ì¼ë˜ ì½”ë“œë¥¼ useReducerë¡œ ë‹¤ì‹œ ë§Œë“¤ì–´ë³´ì. ì²˜ìŒì—ëŠ” ì½”ë“œê°€ ì¢€ ê¸¸ì–´ì§€ëŠ” ê²ƒ ê°™ê¸°ë„ í• ê²ƒì´ë‹¤. ê·¸ì¹˜ë§Œ ì´ë ‡ê²Œí•˜ë©´ ìš”ì²­ê´€ë¦¬ì— ëŒ€í•œ íŒŒì¼ì„ ë”°ë¡œ ê´€ë¦¬í•´ì„œ ì¬ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤. ì¼ë‹¨ useStateë¡œ ì¼ë˜ ì½”ë“œë¥¼ ì§€ìš°ì. ê·¸ë¦¬ê³  ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•´ì¤€ë‹¤.

> Users.js

```javascript
import React, { useEffect, useReducer } from "react";
import axios from "axios";

// LOADING, SUCCESS, ERROR
function reducer(state, action) {
  switch (action.type) {
    case "LOADING":
      return {
        loading: true,
        data: null,
        error: null,
      };
    case "SUCCESS":
      return {
        loading: false,
        data: action.data,
        error: null,
      };
    case "ERROR":
      return {
        loading: false,
        data: null,
        error: action.error,
      };
    default:
      throw new Error(`Unhandled action type: ${action.type}`);
  }
}

function Users() {
  const [state, dispatch] = useReducer(reducer, {
    loading: false,
    data: null,
    error: null,
  });
  useEffect(() => {
    const fetchUsers = async () => {
      dispatch({ type: "LOADING" });
      try {
        const response = await axios.get(
          "https://jsonplaceholder.typicode.com/users/"
        );
        dispatch({ type: "SUCCESS", data: response.data });
      } catch (e) {
        dispatch({ type: "Error", error: e });
      }
    };
    fetchUsers();
  }, []);

  const { loading, data: users, error } = state;
  if (loading) return <div>ë¡œë”©ì¤‘..</div>;
  if (error) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. </div>;
  if (!users) return null;
  return (
    <ul>
      {users.map((user) => (
        <li key={user.id}>
          {user.username} ({user.name})
        </li>
      ))}
    </ul>
  );
}
export default Users;
```

ì´ë ‡ê²Œ reducerë¥¼ ìƒë‹¨ì— í•¨ìˆ˜ë¡œ ë”°ë¡œ ì“¸ ìˆ˜ ìˆë‹¤. ê·¸ë¦¬ê³  VSCì˜ ê¸°ëŠ¥ì„ ì´ìš©í•˜ë©´ ë°”ë¡œ íŒŒì¼ ë¶„ë¦¬ë„ ê°€ëŠ¥í•˜ë‹¤. ë¨¼ì € reducerì˜ ì´ë¦„ì„ acyncReducerë¡œ ë°”ê¾¸ê³  ì´ë¦„ë¶€ë¶„ì„ ì˜¤ë¥¸í´ë¦­ í•´ë³´ì. 'Refactor...'ì„ ëˆ„ë¥´ê³  'Move to new file'ì„ í•˜ë©´ íŒŒì¼ì´ ë¶„ë¦¬ë˜ì–´ ìƒˆë¡œ ìƒì„±ëœë‹¤(ìœ ë ˆì¹´!) ì´ë ‡ê²Œ í•  ìˆ˜ ìˆë‹¤ëŠ” ê±¸ ì•Œì•„ë‘ê³  ì¼ë‹¨ ì›ìƒ ë³µê·€í•œë‹¤.

# useAsync ì»¤ìŠ¤í…€ Hook ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ê¸°

> useAsync.js

```javascript
import { useReducer, useEffect, useCallback } from "react";

// LOADING, SUCCESS, ERROR
function reducer(state, action) {
  switch (action.type) {
    case "LOADING":
      return {
        loading: true,
        data: null,
        error: null,
      };
    case "SUCCESS":
      return {
        loading: false,
        data: action.data,
        error: null,
      };
    case "ERROR":
      return {
        loading: false,
        data: null,
        error: action.error,
      };
    default:
      throw new Error(`Unhandled action type: ${action.type}`);
  }
}

function useAsync(callback, deps = []) {
  //exportë¥¼ ì´ë ‡ê²Œ í•  ìˆ˜ë„ ìˆìŒ
  //deps dependency
  const [state, dispatch] = useReducer(reducer, {
    loading: false,
    data: null,
    error: null,
  });

  const fetchData = async () => {
    dispatch({ type: "LOADING" });
    try {
      const data = await callback();
      dispatch({ type: "SUCCESS", data });
    } catch (e) {
      dispatch({ type: "ERROR", error: e });
    }
  };

  useEffect(() => {
    fetchData();
    // eslint-disable-next-line
  }, deps);

  return [state, fetchData];
}
export default useAsync;
```

ê·¸ë¦¬ê³  Users.jsëŠ” ì•„ë˜ì™€ ê°™ì´ ë°”ê¿”ë³´ì.

> Users.js

```javascript
import React from "react";
import axios from "axios";
import useAsync from "./useAsync";

async function getUsers() {
  const response = await axios.get(
    "https://jsonplaceholder.typicode.com/users"
  );
  return response.data;
}

function Users() {
  const [state, refetch] = useAsync(getUsers, []);

  const { loading, data: users, error } = state;
  if (loading) return <div>ë¡œë”©ì¤‘..</div>;
  if (error) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. </div>;
  if (!users) return null;

  return (
    <>
      <ul>
        {users.map((user) => (
          <li key={user.id}>
            {user.username} ({user.name})
          </li>
        ))}
      </ul>
      <button onClick={refetch}>ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </>
  );
}
export default Users;
```

ì§€ê¸ˆì˜ ê²½ìš°ì—ëŠ” ì²˜ìŒ ë Œë”ë§ ë˜ëŠ” ì‹œì ì—ë§Œ ë°ì´í„° ìš”ì²­ì´ ì´ë£¨ì–´ì§€ê³  ìˆëŠ”ë°, ë§Œì•½ì— ì»´í¬ë„ŒíŠ¸ê°€ ì²˜ìŒ ë Œë”ë§ ë ë•ŒëŠ” ìš”ì²­í•˜ì§€ ì•Šê³  íŠ¹ì • ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ì§€ë§Œ ìš”ì²­ì„ ì‹œì‘í•˜ê³  ì‹¶ë‹¤ë©´ ì–´ë–»ê²Œ í•˜ëŠ”ì§€ ì•Œì•„ë³´ì.  
ê¸€ì„ ì‘ì„±í•œë‹¤ë˜ì§€ ìˆ˜ì •í•œë‹¤ë˜ì§€ ë“± ì‚¬ìš©ìì˜ íŠ¹ì • ì¸í„°ë ‰ì…˜ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ ë°œìƒí•˜ëŠ”ê²Œ ì¼ë°˜ì ì´ê¸° ë•Œë¬¸ì´ë‹¤.

> useAsync.js

```javascript
import { useReducer, useEffect, useCallback } from "react";

// LOADING, SUCCESS, ERROR
function reducer(state, action) {
  switch (action.type) {
    case "LOADING":
      return {
        loading: true,
        data: null,
        error: null,
      };
    case "SUCCESS":
      return {
        loading: false,
        data: action.data,
        error: null,
      };
    case "ERROR":
      return {
        loading: false,
        data: null,
        error: action.error,
      };
    default:
      throw new Error(`Unhandled action type: ${action.type}`);
  }
}

function useAsync(callback, deps = [], skip = false) {
  //skip ì¶”ê°€
  const [state, dispatch] = useReducer(reducer, {
    loading: false,
    data: null,
    error: null,
  });

  const fetchData = async () => {
    dispatch({ type: "LOADING" });
    try {
      const data = await callback();
      dispatch({ type: "SUCCESS", data });
    } catch (e) {
      dispatch({ type: "ERROR", error: e });
    }
  };

  useEffect(() => {
    if (skip) {
      //skip ì¶”ê°€
      return;
    }
    fetchData();
  }, deps);

  return [state, fetchData];
}

export default useAsync;
```

> Users.js

```javascript
import React from "react";
import axios from "axios";
import useAsync from "./useAsync";

async function getUsers() {
  const response = await axios.get(
    "https://jsonplaceholder.typicode.com/users"
  );
  return response.data;
}

function Users() {
  const [state, refetch] = useAsync(getUsers, [], true); //ì„¸ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì¸ skip = true

  const { loading, data: users, error } = state;
  if (loading) return <div>ë¡œë”©ì¤‘..</div>;
  if (error) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. </div>;
  if (!users) return <button onClick={refetch}>ë¶ˆëŸ¬ì˜¤ê¸°</button>; //ë¶ˆëŸ¬ì˜¤ê¸° ì¶”ê°€

  return (
    <>
      <ul>
        {users.map((user) => (
          <li key={user.id}>
            {user.username} ({user.name})
          </li>
        ))}
      </ul>
      <button onClick={refetch}>ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </>
  );
}

export default Users;
```

ê·¸ëŸ¼ ì•„ë˜ì™€ ê°™ì´ 'ë¶ˆëŸ¬ì˜¤ê¸°'ë¥¼ í•œ ë‹¤ìŒì— ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.  
![ë¦¬ì•¡íŠ¸í™”ë©´](/images/200918-2.png)
![ë¦¬ì•¡íŠ¸í™”ë©´](/images/200918-3.png)

ì´ë²ˆì—ëŠ” APIì—ì„œ íŠ¹ì • ì•„ì´ë””ë¥¼ ì¡°íšŒí•´ì„œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ í•´ë³´ì.  
ìš°ì„  ìƒˆë¡œìš´ ì»´í¬ë„ŒíŠ¸ User.jsë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.

> User.js

```javascript
import React from "react";
import axios from "axios";
import useAsync from "./useAsync";

async function getUser(id) {
  const response = await axios.get(
    `http://jsonplaceholder.typicode.com/users/${id}`
  );
  return response.data;
}

function User({ id }) {
  const [state] = useAsync(() => getUser(id), [id]);
  const { loading, data: user, error } = state;

  if (loading) return <div>ë¡œë”©ì¤‘...</div>;
  if (error) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>;
  if (!user) return null;
  return (
    <div>
      <h2>{user.username}</h2>
      <p>
        <b>Email:</b> {user.email}
      </p>
    </div>
  );
}

export default User;
```

ê·¸ë¦¬ê³  Usersë¥¼ ìˆ˜ì •í•´ë³´ì.

> Users.js

```javascript
import React, { useState } from "react";
import axios from "axios";
import useAsync from "./useAsync";
import User from "./User"; //User ì¶”ê°€

async function getUsers() {
  const response = await axios.get("http://jsonplaceholder.typicode.com/users");
  return response.data;
}

function Users() {
  const [state, refetch] = useAsync(getUsers, [], true);
  const [userId, setUserId] = useState(null);

  const { loading, data: users, error } = state;
  if (loading) return <div>ë¡œë”©ì¤‘..</div>;
  if (error) return <div>ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. </div>;
  if (!users) return <button onClick={refetch}>ë¶ˆëŸ¬ì˜¤ê¸°</button>;

  return (
    <>
      <ul>
        {users.map((user) => (
          <li
            key={user.id}
            //lië¥¼ í´ë¦­í•˜ë©´ User ë³´ì´ë„ë¡ ì¶”ê°€
            onClick={() => setUserId(user.id)}
          >
            {user.username} ({user.name})
          </li>
        ))}
      </ul>
      <button onClick={refetch}>ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
      {userId && (
        <User
          //Userì»´í¬ë„ŒíŠ¸ ë¶ˆëŸ¬ì™€ì„œ Userì˜ ì•„ì´ë””ë¥¼ ê°€ì ¸ì™€ì¤Œ
          id={userId}
        />
      )}
    </>
  );
}

export default Users;
```

![ë¦¬ì•¡íŠ¸í™”ë©´](/images/200918-4.gif)
ìš°ë¦¬ê°€ ë§Œì•½ì— ìš”ì²­ìƒíƒœë¥¼ ê´€ë¦¬í•´ì•¼í• ë•Œë§ˆë‹¤ useState ì„¸ê°œì”© ë§Œë“¤ì–´ì•¼ í–ˆë‹¤ë©´ êµ‰ì¥íˆ ê·€ì°®ì•˜ì„ ê²ƒì´ë‹¤.
ë Œë”ë§ ë ë•Œ ë°ì´í„°ë¥¼ ìš”ì²­í•´ì•¼í•˜ëŠ” ìƒí™©ì—ë§Œ userAsync Hookì„ ë§Œë“¤ì–´ì„œ useEffectë„ ëŒ€ì‹  í•´ì£¼ê²Œë” ì‚¬ìš©í•˜ë©´ ì½”ë“œë¥¼ ë§ì´ ì•„ë‚„ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.  
ê·¸ë¦¬ê³  fetchDataë„ Hookìœ¼ë¡œ ë§Œë“¤ì–´ì„œ ì¨ì£¼ì–´ì„œ ë§¤ë²ˆ ì•ˆë§Œë“¤ì–´ ì¤˜ë„ ë˜ê²Œë” í•´ë³´ì•˜ë‹¤.  
ì´ì œ ì´ Hookì´ ì–´ë–»ê²Œ ë§Œë“¤ì—ˆëŠ”ì§€ ë°°ì› ìœ¼ë‹ˆ ê°œì¸ì˜ ìš©ë„ì— ë§ì¶°ì„œ ê³„ì† í™œìš©í•´ë³´ì!

ì˜¤ëŠ˜ì€ ì—¬ê¸°ê¹Œì§€..  
ì‹œì²­ ì˜ìƒ 33ê°• 03~04ê¹Œì§€

![ìˆ˜ê°•ì¸ì¦ì´ë¯¸ì§€](/images/200918-1.jpeg)
í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ì˜¬ì¸ì› íŒ¨í‚¤ì§€ with React Online. ğŸ‘‰ https://bit.ly/31Cf1hp
